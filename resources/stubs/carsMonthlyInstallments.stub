@extends('themes.car-web.layouts.default')

@section('title')

@endsection

@section('load')
    <script type="text/javascript">
        $(document).ready(function () {
            $(".insMonth").on('click', function (event) {
                event.stopPropagation();
                event.stopImmediatePropagation();
                var mPay = $('#monthlyPrice').val();
                var fPay = $('#firstPay').val();
                var months = $(this).val();
                var invest = 0.03;
                if (months <= 12) {
                    invest = 0.025
                }
                else if (months > 12 && months <= 18) {
                    invest = 0.026
                }
                else if (months > 12 && months <= 24) {
                    invest = 0.027
                }
                else if (months > 24) {
                    invest = 0.028
                }
                var loValue = mPay / (invest / (1 - Math.pow(1 + invest, -months)))
                var totalPrice = Math.round(loValue + (loValue * fPay / (100 - fPay)));
                var firstPayValue = Math.round(totalPrice * (fPay / 100));
                document.getElementById("firstPayValue").innerHTML = firstPayValue + '₮ (' + fPay + '%)';
                document.getElementById("totalPrice").innerHTML = totalPrice + ' ₮';
                //document.getElementById("searchByTotPrice"). =;
                $('#searchByTotPrice').attr("value", totalPrice);

            });

            $("#searchFitCars").on('click', function (event) {
                event.stopPropagation();
                event.stopImmediatePropagation();

            });

            function number_format(number, decimals, dec_point, thousands_sep) {
                // Strip all characters but numerical ones.
                number = (number + '').replace(/[^0-9+\-Ee.]/g, '');
                var n = !isFinite(+number) ? 0 : +number,
                    prec = !isFinite(+decimals) ? 0 : Math.abs(decimals),
                    sep = (typeof thousands_sep === 'undefined') ? ',' : thousands_sep,
                    dec = (typeof dec_point === 'undefined') ? '.' : dec_point,
                    s = '',
                    toFixedFix = function (n, prec) {
                        var k = Math.pow(10, prec);
                        return '' + Math.round(n * k) / k;
                    };
                // Fix for IE parseFloat(0.55).toFixed(0) = 0;
                s = (prec ? toFixedFix(n, prec) : '' + Math.round(n)).split('.');
                if (s[0].length > 3) {
                    s[0] = s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g, sep);
                }
                if ((s[1] || '').length < prec) {
                    s[1] = s[1] || '';
                    s[1] += new Array(prec - s[1].length + 1).join('0');
                }
                return s.join(dec);
            }


            // $(".insMonth").click(
            //     console.log("wwwwwww")
            //     // function (e) {
            //     //     var markName=$(this).val();
            //     //     $.ajax({
            //     //         type: 'Get',
            //     //         url: '/api/v1/taxonomies/car-'+toKebabCase(markName),
            //     //         // /data: paramObjs
            //     //     }).done(function(data) {
            //     //         console.log("DONE!");
            //     //         var modelList=data;
            //     //         $('#vehicleManufacturerModels')
            //     //             .find('option')
            //     //             .remove()
            //     //             .end()
            //     //             .append('<option>Model</option>')
            //     //             .val('')
            //     //         ;
            //     //         console.log(modelList.data);
            //     //         var i;
            //     //         for (i = 0; i < modelList.data.length; i++) {
            //     //             console.log(modelList.data[i].term.name);
            //     //             $("#vehicleManufacturerModels").append(new Option(modelList.data[i].term.name, modelList.data[i].id));
            //     //         }
            //     //     }).fail(function(err) {
            //     //         // $("#demo-spinner").css({'display': 'none'});
            //     //         console.error("FAIL!");
            //     //         console.error(err);
            //     //     });
            //     // }
            // )
        })
    </script>

@endsection

@section('content')

    {{--<div class="bg-page-header"></div>--}}

    <section id="loan" class="text-center mt-5  finance-section bg-dark">
        <div class="container">
            <div class="row">
                <div class="card shadow-soft-blue page-top-navbar mb-5">
                    <div class="d-flex justify-content-around">
                        <a href="#">Finance information</a>
                        <a href="#" class="active">Search your vehicle for monthly installments</a>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-8 col-md-7">
                    <div class="card shadow-soft-blue">
                        <div class="card-body text-left">

                            <div class="row">
                                <div class="form-group col-md-6 float-left">
                                    <label for="monthlyPrice">Monthly price</label>
                                    <input type="number" class="form-control" id="monthlyPrice" placeholder="">
                                </div>
                                <div class="form-group col-md-6 float-left">
                                    <label for="firstPay">First pay</label>
                                    <select class="form-control" id="firstPay">
                                        <option value="80">80%</option>
                                        <option value="70">70%</option>
                                        <option value="60">60%</option>
                                        <option value="50">50%</option>
                                        <option value="40">40%</option>
                                        <option value="30">30%</option>
                                        <option value="20">20%</option>
                                    </select>
                                </div>
                            </div>


                            <p>Installment period</p>
                            <div class="select-month">
                                <div class="custom-control custom-radio custom-control-inline">
                                    <input type="radio" id="6month" name="financeMonth" value="6" class="custom-control-input insMonth" checked>
                                    <label class="custom-control-label insMonth" for="6month">6 month</label>
                                </div>
                                <div class="custom-control custom-radio custom-control-inline">
                                    <input type="radio" id="12month" name="financeMonth" value="12" class="custom-control-input insMonth">
                                    <label class="custom-control-label insMonth" for="12month">12 month</label>
                                </div>
                                <div class="custom-control custom-radio custom-control-inline">
                                    <input type="radio" id="18month" name="financeMonth" value="18" class="custom-control-input insMonth">
                                    <label class="custom-control-label insMonth" for="18month">18 month</label>
                                </div>
                                <div class="custom-control custom-radio custom-control-inline">
                                    <input type="radio" id="24month" name="financeMonth" value="24" class="custom-control-input insMonth">
                                    <label class="custom-control-label insMonth" for="24month">24 month</label>
                                </div>
                                <div class="custom-control custom-radio custom-control-inline">
                                    <input type="radio" id="30month" name="financeMonth" value="30" class="custom-control-input insMonth">
                                    <label class="custom-control-label" for="30month">30 month</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-5">
                    <div class="card monthly-payment" style="border: 1px solid #858994">
                        <div class="card-body">
                            <p class="text-muted">First pay</p>
                            <h4 class="font-weight-bolder" id="firstPayValue">0 ₮ </h4>
                            <p class="mt-3 text-muted">Total price of vehicle</p>
                            <h2 class="font-weight-bolder" id="totalPrice">0 ₮</h2>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-12 text-center">
                <form method="GET" action="/monthly-installments">
                    @csrf
                    <input hidden id="searchByTotPrice" name="priceAmount">
                    <button type="submit" id="searchFitCars" class="btn btn-danger btn-round  mt-5 px-5 btn-lg">Хайлт хийх</button>
                </form>
            </div>
        </div>
    </section>

    <section id="hot-deal" class="mainPage-items bg-white">
        <div class="container">
            <div class="row">
                <div class="section-title">

                </div>

                <div class="card-list">
                    <div class="row">
                        {{--@contents({"filter":[{"field":"type", "key":"car"}, {"field":"status", "key":"published"}], "metasFilter": [{"key":"publishType", "value":"best_premium"}], "limit":12, "returnVariable":"carDataPremium"})--}}
                        @content(type=car, priceAmount < intval(request()->input("priceAmount")) as $carDataMonthly |
                        paginate)

                    {{--{{$carDataMonthly->slug}}--}}
                    <!-- col-start -->
                        <div class="col-lg-3 col-md-4">
                            <!-- card start -->
                            <a href="{{$carDataMonthly->slug}}" target="_blank" class="card cd-box">
                                <div class="premium-tag shadow-soft-blue"><img
                                        src="{{asset('car-web/img/icons/corona.svg')}}" alt=""></div>
                                <div class="card-img">
                                    <img src="{{$carDataMonthly->metaValue("thumbnail")}}" class="img-fluid"
                                         alt="alt">

                                    <div class="card-caption">
                                        <div
                                            class="meta">{{$carDataMonthly->metaValue("mileageAmaount")}} {{$carDataMonthly->metaValue("mileageUnit")}}
                                            | {{$carDataMonthly->metaValue("fuelType")}}
                                            | {{$carDataMonthly->metaValue("capacityAmount")}} {{$carDataMonthly->metaValue("capacityunit")}}</div>
                                        <div class="favorite">
                                            <i class="icon-heart"></i>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body py-2">
                                    <div class="card-description">
                                        <div class="card-desc-top">
                                            <div class="card-title">{{$carDataMonthly->title}}</div>
                                            <div
                                                class="price">{{numerizePrice($carDataMonthly->metaValue("priceAmount"))}} {{$carDataMonthly->metaValue("priceUnit")}}</div>
                                        </div>

                                        <div class="card-meta">
                                            <div class="year">{{$carDataMonthly->metaValue("buildYear")}}
                                                / {{$carDataMonthly->metaValue("importDate")}}</div>
                                        </div>
                                        <div class="status">{{$carDataMonthly->metaValue("priceType")}}</div>
                                    </div>
                                </div>
                            </a>
                            <!-- card end -->
                        </div>
                        <!-- col-end -->
                        @endcontent
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="pageType-footer">
        <div class="container">
            <div class="row">
                <div class="sell-type-img sell-car">
                    <img src="{{ asset('car-web/img/sell-car.png') }}" alt="">
                </div>
            </div>
        </div>
    </section>

@endsection

@section('script')

@endsection
